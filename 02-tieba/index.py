import urllib.request
from fake_useragent import UserAgent

from bs4 import BeautifulSoup


proxy = {
    'http':'183.232.231.118:443'
}


def get_fake_userAgent():
    try:
        return {
            'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36 Edg/105.0.1343.53',
            'Connection':'keep-alive',
            'Upgrade-Insecure-Requests':'1',
            'Host':'tieba.baidu.com',
            'Accept':'text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9',
            'Cookie':'__yjs_duid=1_ebd12aac0da2bb347a3b49fde208ae2e1645889762116; BAIDUID=08B79D386A3EE9352F7DF6B29375CF38:FG=1; BAIDUID_BFESS=08B79D386A3EE9352F7DF6B29375CF38:FG=1; BIDUPSID=08B79D386A3EE9352F7DF6B29375CF38; PSTM=1650814147; BAIDU_WISE_UID=wapp_1651036635841_244; BDUSS_BFESS=XpKSnFFYjRzeUpjYlg5bElnY2FpUmpqUzlBNnRteldlclAyc0FaazRHbDJoYUppRVFBQUFBJCQAAAAAAAAAAAEAAABs0vWowO6w17yqwPsAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAAHb4emJ2-HpiW; H_WISE_SIDS=110085_127969_179349_180638_185633_188333_188748_189755_191527_194085_194519_194529_196427_197471_197711_199581_204915_207236_207541_208607_208721_209568_210301_210321_211288_211952_212286_212295_212416_212726_212873_212908_213042_213060_213094_213273_213347_213729_213940_214093_214189_214205_214264_214394_214596_214655_214790_215071_215126_215280_215490_215680_215731_215861_215891_215959_216000_216253_216333_216353_216596_216631_216634_216645_216844_216911_216926_216943_217089_217183_217229_217271_217385_217451_217494_217836_218030; IS_NEW_USER=f26212b20ee508a8ade8583b; TIEBAUID=402bc30905ddab8b2b74f48d; rpln_guide=1; H_WISE_SIDS_BFESS=110085_127969_179349_180638_185633_188333_188748_189755_191527_194085_194519_194529_196427_197471_197711_199581_204915_207236_207541_208607_208721_209568_210301_210321_211288_211952_212286_212295_212416_212726_212873_212908_213042_213060_213094_213273_213347_213729_213940_214093_214189_214205_214264_214394_214596_214655_214790_215071_215126_215280_215490_215680_215731_215861_215891_215959_216000_216253_216333_216353_216596_216631_216634_216645_216844_216911_216926_216943_217089_217183_217229_217271_217385_217451_217494_217836_218030; Hm_lvt_7d6994d7e4201dd18472dd1ef27e6217=1662253568; STOKEN=6a055929fc5db420f84c51e208be98ec7cb7728c38f1ad3fccfdee84f5227eb1; ZFY=vYTR6hTN3v9x3ZmVPMb0ZNBu62SKRCMs9GTB:BsHn4iE:C; BA_HECTOR=a085800k8g2g80aha58l02at1hj7u2i1b; ariaDefaultTheme=undefined; Hm_lvt_98b9d8c2fd6608d564bf2ac2ae642948=1664245161,1664265129,1664373650,1664431130; 2834682476_FRSVideoUploadTip=1; video_bubble2834682476=1; USER_JUMP=-1; st_key_id=17; wise_device=0; Hm_lpvt_98b9d8c2fd6608d564bf2ac2ae642948=1664431472; ab_sr=1.0.1_NDVmNWE2YjhkOThiN2UyZmU2M2Q1NjBiZTg1ZjNiMWJlMzUzODg1YjM1YjI4NGViZTU4NTkyM2Y1NzUyZDNmY2Q0YjBhZGQ5ZjZmMjllMDc3OWQ4OTk5NjRiNjA5MGE3OWQzYzQ2ZTUwNWIxNDgxZmY0ODViYzE1YjdkNGUyZTZiMThjYWY3MjYwNmI5ZDhiZDVlZjgwMDFiOTI4MGVhMjExMmE2NjEzZTY1ZDIyNmI3MTczNGZlOGY0N2U0ODRi; st_data=ca5b00b48a49cac620db4a64a3205e51200b519a99047271a8568b5027e80c18c42db7d91392dfbd11cc24a66786c8a19345b9faf4417f2ee977fcce2da81091c18d0f73f37c7b3bc0618ad1297372cb585333d77f54770c6d7361d2a9f886ea; st_sign=e475b3a0; RT="z=1&dm=baidu.com&si=4ab3cc3a-5ef9-4da6-b59b-b1c40c8021ac&ss=l8mnbewd&sl=d&tt=vh0&bcn=https://fclog.baidu.com/log/weirwood?type=perf&ld=bi8i&nu=4ss4lb0u&cl=j9gu&ul=lrvd"'
        }
    except:
         return {
            'User-Agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/105.0.0.0 Safari/537.36 Edg/105.0.1343.50'
        }


url = 'https://tieba.baidu.com/f?ie=utf-8&kw=%E9%80%86%E5%A4%A9%E9%82%AA%E7%A5%9E'

req = urllib.request.Request(url=url,headers=get_fake_userAgent());
handler = urllib.request.ProxyHandler(proxies=proxy)
response = urllib.request.urlopen(req)

# print(response.status,response.read().decode("utf-8"))


if response.status == 200:
    data = response.read().decode('utf-8')
    content = BeautifulSoup(data,'lxml')
    print(content.select('ul#thread_list'))
else:
    pass